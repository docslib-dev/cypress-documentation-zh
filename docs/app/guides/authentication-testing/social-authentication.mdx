---
title: 'ç¤¾äº¤ç™»å½•è®¤è¯ï¼šCypressæŒ‡å—'
sidebar_label: 'ç¤¾äº¤ç™»å½•è®¤è¯'
description: 'ä½¿ç”¨cy.origin()ä¸å¸¸è§ç¤¾äº¤å¹³å°è¿›è¡Œè®¤è¯ï¼Œå¹¶é€šè¿‡cy.session()ç¼“å­˜å·²è®¤è¯ç”¨æˆ·ã€‚'
---

<ProductHeading product="app" />

# ç¤¾äº¤ç™»å½•è®¤è¯

:::info

##### <Icon name="question-circle" color="#4BBFD2" /> å­¦ä¹ å†…å®¹

- å¦‚ä½•ä½¿ç”¨`cy.origin()`é€šè¿‡Auth0ç§Ÿæˆ·è¿›è¡Œè®¤è¯
- å¦‚ä½•ä½¿ç”¨`cy.session()`ç¼“å­˜å·²è®¤è¯ç”¨æˆ·

:::

:::caution

<Icon name="exclamation-triangle" /> **ä¸æ¨èåœ¨CIä¸­ä½¿ç”¨**

Cypress**ä¸**æ¨èå°†æµ‹è¯•ç¤¾äº¤è¿æ¥è®¤è¯ä½œä¸ºä¸»è¦çš„è®¤è¯æµ‹è¯•æ‰‹æ®µã€‚è¿™æ˜¯ç”±äºæˆ‘ä»¬åœ¨[æœ€ä½³å®è·µæŒ‡å—](/app/core-concepts/best-practices)ä¸­æåˆ°çš„[æŒ‘æˆ˜](/app/core-concepts/best-practices#Potential-Challenges-Authenticating-with-Social-Platforms)ã€‚

åœ¨CIä¸­ä¾èµ–ç¤¾äº¤è®¤è¯å¾ˆå¯èƒ½è§¦å‘æœºå™¨äººæ£€æµ‹æœºåˆ¶ï¼Œå¹¶å¯èƒ½å› è¿åæœåŠ¡æä¾›å•†æ¡æ¬¾è€Œå¯¼è‡´è´¦å·æš‚åœã€‚

:::

## åº”ç”¨è®¾ç½®

æœ¬æŒ‡å—å°†é…ç½®ä¸€ä¸ªä½¿ç”¨Auth0ç§Ÿæˆ·çš„åº”ç”¨ï¼Œè¯¥ç§Ÿæˆ·å·²è®¾ç½®Googleã€Facebookå’ŒMicrosoftçš„ç¤¾äº¤è¿æ¥ï¼Œå¯ä»£è¡¨ç”¨æˆ·å‘æˆ‘ä»¬çš„åº”ç”¨è¿›è¡Œè®¤è¯ã€‚

### è®¾ç½®Auth0ç§Ÿæˆ·

é¦–å…ˆåˆ›å»ºä¸€ä¸ªå…è´¹çš„[Auth0](https://auth0.com/signup)è´¦å·ï¼Œé€‰æ‹©**æˆ‘æ˜¯æ–°Auth0ç”¨æˆ·**æµç¨‹ã€‚åŒ…å«4ä¸ªæ­¥éª¤ï¼š

- **æ­¥éª¤1:** é…ç½®ç¤ºä¾‹åº”ç”¨æ—¶ï¼Œè¯·ä¸ºæ‚¨çš„å¹³å°é€‰æ‹©**å•é¡µåº”ç”¨**ï¼ŒæŠ€æœ¯æ ˆé€‰æ‹©**React**
- **æ­¥éª¤2:** åœ¨**ç¤¾äº¤è¿æ¥**ä¸­ï¼Œè¯·é€‰æ‹©**Facebook**ã€**Microsoft**å’Œ**Google**
- **æ­¥éª¤3:** å°è¯•ç™»å½•å¹¶éªŒè¯è¿æ¥æ˜¯å¦è®¾ç½®æ­£ç¡®
- **æ­¥éª¤4:** å¯é€šè¿‡**ä¸‹è½½ç¤ºä¾‹åº”ç”¨**æŒ‰é’®æˆ–[æ­¤å¤„](https://github.com/auth0-samples/auth0-react-samples/tree/d5848ed710db85d6ef060731b296603c0eca744b/Sample-01)å…‹éš†è·å–ç¤ºä¾‹ã€‚ä¸‹ä¸€æ­¥éœ€è¦æ­¤åº”ç”¨ã€‚é€‰æ‹©**æˆ‘å·²å‡†å¤‡å¥½ä½¿ç”¨Auth0**ã€‚ç°åœ¨æ‚¨çš„Auth0ç§Ÿæˆ·ç¤¾äº¤è¿æ¥åº”å·²æ­£ç¡®é…ç½®

### è®¾ç½®åº”ç”¨

åœ¨Auth0ä»ªè¡¨æ¿å·¦ä¾§èœå•è®¿é—®**åº”ç”¨ä¸‹æ‹‰æ¡†**ï¼Œé€‰æ‹©ä¸‹æ‹‰æ¡†å¹¶è¿›å…¥**åº”ç”¨**ã€‚

- é€‰æ‹©**é»˜è®¤åº”ç”¨**
- è®¿é—®**è®¾ç½®**æ ‡ç­¾é¡µ
  - å¤åˆ¶**åŸºæœ¬ä¿¡æ¯**ä¸­çš„`domain`å’Œ`client ID`å­—æ®µï¼Œåç»­ä¼šç”¨åˆ°
  - **åº”ç”¨å±æ€§**ä¸­**åº”ç”¨ç±»å‹**åº”é€‰æ‹©**å•é¡µåº”ç”¨**
  - åœ¨**åº”ç”¨URI**ä¸­ï¼Œè¯·å°†`http://localhost:3000`æ·»åŠ åˆ°**å…è®¸çš„å›è°ƒURL**ã€**å…è®¸çš„Webæ¥æº**å’Œ**å…è®¸çš„ç™»å‡ºURL**
- æŒ‰ç…§[ç¤ºä¾‹åº”ç”¨](https://github.com/auth0-samples/auth0-react-samples/tree/d5848ed710db85d6ef060731b296603c0eca744b/Sample-01#create-an-api)è¯´æ˜ï¼Œä»[`src/auth_config.json.example`](https://github.com/auth0-samples/auth0-react-samples/blob/d5848ed710db85d6ef060731b296603c0eca744b/Sample-01/src/auth_config.json.example)åˆ›å»º`src/auth_config.json`æ–‡ä»¶
- åˆ›å»ºåï¼Œå°†`domain`å’Œ`client ID`ç²˜è´´åˆ°`src/auth_config.json`å¯¹åº”å­—æ®µã€‚å¯ç§»é™¤`audience`é”®ã€‚ç™»å½•/å›è°ƒURIé»˜è®¤ä¸º`http://localhost:3000`ï¼Œå³æµ‹è¯•åº”ç”¨çš„URL
- [å®‰è£…](https://github.com/auth0-samples/auth0-react-samples/tree/d5848ed710db85d6ef060731b296603c0eca744b/Sample-01#project-setup)åº”ç”¨ä¾èµ–å¹¶[å¯åŠ¨å¼€å‘æœåŠ¡å™¨](https://github.com/auth0-samples/auth0-react-samples/tree/d5848ed710db85d6ef060731b296603c0eca744b/Sample-01#compile-and-hot-reload-for-development)
- è®¿é—®`http://localhost:3000`éªŒè¯åº”ç”¨è¿è¡Œæ­£å¸¸ï¼Œç‚¹å‡»å³ä¸Šè§’**ç™»å½•**æŒ‰é’®ã€‚é€‰æ‹©ä»»ä¸€ç¤¾äº¤è¿æ¥ç™»å½•å¹¶ç¡®ä¿å®Œæˆ**æˆæƒåº”ç”¨**æç¤º(åªéœ€æ“ä½œä¸€æ¬¡)ã€‚è¿™å°†å¸¦æ‚¨å›åˆ°å·²è®¤è¯çš„ç¤ºä¾‹åº”ç”¨ã€‚å®Œæˆåç‚¹å‡»**ç™»å‡º**ä¸‹æ‹‰æŒ‰é’®ã€‚å¯¹Googleã€Microsoftå’ŒFacebookæˆ–æ‚¨æƒ³æµ‹è¯•çš„è´¦å·é‡å¤æ­¤è¿‡ç¨‹

ä»¥ä¸‹æ˜¯Facebookè®¾ç½®çš„è¿‡ç¨‹ç¤ºä¾‹ï¼š

<DocsVideo
  src="https://vimeo.com/789093604"
  title="Facebookç¤¾äº¤åº”ç”¨è®¾ç½®"
/>

## ä½¿ç”¨Cypressæµ‹è¯•

ç°åœ¨åº”ç”¨å·²è®¾ç½®å®Œæ¯•ï¼Œå¯ä»¥ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•äº†ã€‚

:::caution
å¯¹äºè¿™äº›ç¤¾äº¤è¿æ¥ï¼Œå¿…é¡»å¯ç”¨[`experimentalModifyObstructiveThirdPartyCode`](/app/guides/cross-origin-testing#Modifying-Obstructive-Third-Party-Code)é…ç½®é€‰é¡¹ã€‚
:::

## åœ¨Cypressä¸­è®¾ç½®Auth0åº”ç”¨å‡­è¯

è¦åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ç¤¾äº¤è´¦å·å‡­è¯ï¼Œéœ€è¦é…ç½®Cypressé€šè¿‡`cypress.env.json`æ–‡ä»¶æˆ–[æ”¯æŒçš„æ–¹æ³•](/app/references/environment-variables#Setting)è®¾ç½®ç¤¾äº¤ç”¨æˆ·åã€å¯†ç å’Œåç§°ç¯å¢ƒå˜é‡ã€‚

```json title='cypress.env.json'
{
  "GOOGLE_USERNAME": "",
  "GOOGLE_PASSWORD": "",
  "GOOGLE_NAME": "",
  "MICROSOFT_USERNAME": "",
  "MICROSOFT_PASSWORD": "",
  "MICROSOFT_NAME": "",
  "FACEBOOK_USERNAME": "",
  "FACEBOOK_PASSWORD": "",
  "FACEBOOK_NAME": ""
}
```

### ä½¿ç”¨`cy.origin()`ç™»å½•

æˆ‘ä»¬å°†ç¼–å†™åä¸º`loginToAuth0ViaSocial`çš„è‡ªå®šä¹‰å‘½ä»¤ï¼Œç”¨äºé€šè¿‡Facebookã€Googleæˆ–Microsoftç™»å½•ã€‚è¯¥å‘½ä»¤å°†ä½¿ç”¨[`cy.origin()`](/api/commands/origin)æ¥ï¼š

1. å¯¼èˆªåˆ°Auth0ç™»å½•é¡µ
2. é€‰æ‹©**ç»§ç»­ä½¿ç”¨...**æŒ‰é’®å¹¶ä½¿ç”¨ç¤¾äº¤å‡­è¯ç™»å½•
3. ç™»å½•åé‡å®šå‘å›[ç¤ºä¾‹åº”ç”¨](https://github.com/auth0-samples/auth0-react-samples/tree/d5848ed710db85d6ef060731b296603c0eca744b/Sample-01)
4. ä½¿ç”¨[`cy.session()`](/api/commands/session)ç¼“å­˜ç»“æœ

ä¸ºæ¼”ç¤ºï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªæä¾›å•†ç¼–å†™ä¸€ä¸ªå‡½æ•°ã€‚

#### Facebookç™»å½•å‡½æ•°

```js title="cypress/support/commands.ts"
import { domain as Auth0Domain } from '../../src/auth_config.json'

function logIntoFacebook(username: string, password: string, name: string) {
  cy.visit('http://localhost:3000')
  cy.get('#qsLoginBtn').click()

  cy.origin(Auth0Domain, () => {
    cy.scrollTo('bottom')
    cy.get('form[data-provider="facebook"]').submit()
  })

  cy.origin(
    'https://www.facebook.com',
    {
      args: {
        username,
        password,
      },
    },
    ({ username, password }) => {
      cy.get('input#email').type(username)
      cy.get('input#pass').type(password, {
        log: false,
      })
      cy.get('[type="submit"]').contains('Log In').click()
    }
  )

  cy.get('h6.dropdown-header').should('contain', name)
}
```

#### Googleç™»å½•å‡½æ•°

```js title="cypress/support/commands.ts"
import { domain as Auth0Domain } from '../../src/auth_config.json'

function logIntoGoogle(username: string, password: string, name: string) {
  Cypress.on(
    'uncaught:exception',
    (err) =>
      !err.message.includes('ResizeObserver loop') &&
      !err.message.includes('Error in protected function')
  )
  cy.visit('http://localhost:3000')
  cy.get('#qsLoginBtn').click()

  cy.origin(Auth0Domain, () => {
    cy.scrollTo('bottom')
    cy.get('form[data-provider="google"]').submit()
  })

  cy.origin(
    'https://accounts.google.com',
    {
      args: {
        username,
        password,
      },
    },
    ({ username, password }) => {
      Cypress.on(
        'uncaught:exception',
        (err) =>
          !err.message.includes('ResizeObserver loop') &&
          !err.message.includes('Error in protected function')
      )

      cy.get('input[type="email"]').type(username, {
        log: false,
      })
      // æ³¨æ„ï¼šå…ƒç´ å­˜åœ¨äºåŸå§‹è¡¨å•ä½†è¢«éšè—å¹¶é‡æ–°æ¸²æŸ“ï¼Œå¯èƒ½å¯¼è‡´é—´æ­‡æ€§DOMåˆ†ç¦»é—®é¢˜
      cy.contains('Next').click().wait(4000)
      cy.get('[type="password"]').type(password, {
        log: false,
      })
      cy.contains('Next').click().wait(4000)
    }
  )

  cy.get('h6.dropdown-header').should('contain', name)
}
```

#### Microsoftç™»å½•å‡½æ•°

```js title="cypress/support/commands.ts"
import { domain as Auth0Domain } from '../../src/auth_config.json'

function logIntoMicrosoft(username: string, password: string, name: string) {
  cy.visit('http://localhost:3000')
  cy.get('#qsLoginBtn').click()

  cy.origin(Auth0Domain, () => {
    cy.scrollTo('bottom')
    cy.get('form[data-provider="windowslive"]').submit()
  })

  cy.origin(
    'login.live.com',
    {
      args: {
        username,
        password,
      },
    },
    ({ username, password }) => {
      cy.get('input[type="email"]').type(username)
      cy.get('input[type="submit"]').click()
      cy.get('input[type="password"]').type(password, {
        log: false,
      })
      cy.get('input[type="submit"]').click()
      cy.get('#idBtn_Back').click()
    }
  )

  cy.get('h6.dropdown-header').should('contain', name)
}
```

#### ç»„åˆç™»å½•å‘½ä»¤

æˆ‘ä»¬å¯ä»¥å°†è¿™äº›å‡½æ•°ç»„åˆæˆå•ä¸ªå‘½ä»¤ï¼š

```ts title="cypress/support/commands.ts"
Cypress.Commands.add(
  'loginToAuth0ViaSocial',
  (SOCIAL_PROVIDER: 'microsoft' | 'google' | 'facebook') => {
    const log = Cypress.log({
      displayName: 'Social LOGIN',
      message: [`ğŸ” Authenticating | ${SOCIAL_PROVIDER}`],
      // @ts-ignore
      autoEnd: false,
    })
    log.snapshot('before')

    switch (SOCIAL_PROVIDER) {
      case 'microsoft':
        logIntoMicrosoft(
          Cypress.env('MICROSOFT_USERNAME'),
          Cypress.env('MICROSOFT_PASSWORD'),
          Cypress.env('MICROSOFT_NAME')
        )
        break
      case 'google':
        logIntoGoogle(
          Cypress.env('GOOGLE_USERNAME'),
          Cypress.env('GOOGLE_PASSWORD'),
          Cypress.env('GOOGLE_NAME')
        )
        break
      case 'facebook':
        logIntoFacebook(
          Cypress.env('FACEBOOK_USERNAME'),
          Cypress.env('FACEBOOK_PASSWORD'),
          Cypress.env('FACEBOOK_NAME')
        )
        break
      default:
        throw new Error('no social provider configured!')
    }

    log.snapshot('after')
    log.end()
  }
)
```

ç°åœ¨å¯ä»¥åœ¨æµ‹è¯•ä¸­ä½¿ç”¨`loginToAuth0ViaSocial`å‘½ä»¤ã€‚ä»¥ä¸‹æ˜¯é€šè¿‡Auth0ç™»å½•ç”¨æˆ·å¹¶è¿è¡ŒåŸºæœ¬æ£€æŸ¥çš„æµ‹è¯•ï¼š

```js title='auth.cy.js'
describe('ç¤¾äº¤ç™»å½•æ¼”ç¤º', () => {
  beforeEach(() => {
    // æ­¤å¤„å¯æä¾›facebookã€googleæˆ–microsoft
    cy.loginToAuth0ViaSocial('facebook')
    cy.visit('http://localhost:3000/')
  })

  it('å¯¼èˆªåˆ°åº”ç”¨åæ˜¾ç¤ºç¤ºä¾‹é¡¹ç›®æ ‡é¢˜', () => {
    cy.get('h1').should('contain', 'React.jsç¤ºä¾‹é¡¹ç›®')
  })
})
```

ä»¥ä¸‹æ˜¯ä¸‰ä¸ªæä¾›å•†ä¾æ¬¡è¿è¡Œçš„ç¤ºä¾‹ï¼š

<DocsVideo
  src="https://vimeo.com/789093473"
  title="ä½¿ç”¨cy.origin()æµ‹è¯•Googleã€Microsoftå’ŒFacebookç¤¾äº¤ç™»å½•"
/>

æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é‡æ„ç™»å½•å‘½ä»¤ï¼Œåˆ©ç”¨[`cy.session()`](/api/commands/session)å­˜å‚¨å·²ç™»å½•ç”¨æˆ·ï¼Œé¿å…æ¯æ¬¡æµ‹è¯•å‰é‡æ–°è®¤è¯ã€‚è¿™ä¹Ÿå¤§å¤§é™ä½äº†å› é¢‘ç¹è®¤è¯å°è¯•å¯¼è‡´è´¦å·è¢«å°çš„é£é™©ã€‚å¯ä»¥é€‚å½“ä¼˜åŒ–ä»£ç ï¼

```ts title="cypress/support/commands.ts"
Cypress.Commands.add(
  'loginToAuth0ViaSocial',
  (SOCIAL_PROVIDER: 'microsoft' | 'google' | 'facebook') => {
    const log = Cypress.log({
      displayName: 'Social LOGIN',
      message: [`ğŸ” Authenticating | ${SOCIAL_PROVIDER}`],
      // @ts-ignore
      autoEnd: false,
    })
    log.snapshot('before')

    cy.session(
      `social-${SOCIAL_PROVIDER}`,
      () => {
        switch (SOCIAL_PROVIDER) {
          case 'microsoft':
            logIntoMicrosoft(
              Cypress.env('MICROSOFT_USERNAME'),
              Cypress.env('MICROSOFT_PASSWORD'),
              Cypress.env('MICROSOFT_NAME')
            )
            break
          case 'google':
            logIntoGoogle(
              Cypress.env('GOOGLE_USERNAME'),
              Cypress.env('GOOGLE_PASSWORD'),
              Cypress.env('GOOGLE_NAME')
            )
            break
          case 'facebook':
            logIntoFacebook(
              Cypress.env('FACEBOOK_USERNAME'),
              Cypress.env('FACEBOOK_PASSWORD'),
              Cypress.env('FACEBOOK_NAME')
            )
            break
          default:
            throw new Error('no social provider configured!')
        }
      },
      {
        validate: () => {
          cy.visit('http://localhost:3000')
          switch (SOCIAL_PROVIDER) {
            case 'microsoft':
              cy.get('h6.dropdown-header').should(
                'contain',
                Cypress.env('MICROSOFT_NAME')
              )
              break
            case 'google':
              cy.get('h6.dropdown-header').should(
                'contain',
                Cypress.env('GOOGLE_NAME')
              )
              break
            case 'facebook':
              cy.get('h6.dropdown-header').should(
                'contain',
                Cypress.env('FACEBOOK_NAME')
              )
              break
            default:
              throw new Error('no social provider configured!')
          }
        },
      }
    )

    log.snapshot('after')
    log.end()
  }
)
```

<DocsVideo
  src="https://vimeo.com/789093516"
  title="ä½¿ç”¨cy.session()æµ‹è¯•Facebookç¤¾äº¤ç™»å½•"
/>

é€šè¿‡ä½¿ç”¨[`cy.session()`](/api/commands/session)ï¼Œæˆ‘ä»¬çš„æµ‹è¯•ç°åœ¨åº”è¯¥è¿è¡Œå¾—æ›´å¿«ï¼

å¸Œæœ›æœ¬æŒ‡å—èƒ½å¸®åŠ©æ‚¨é¡ºåˆ©ä½¿ç”¨[`cy.origin()`](/api/commands/origin)å’Œ[`cy.session()`](/api/commands/session)ã€‚å¦‚æœåœ¨éµå¾ªæœ¬æŒ‡å—æ—¶é‡åˆ°ä»»ä½•é—®é¢˜æˆ–æœ‰ä»»ä½•åé¦ˆï¼Œè¯·æäº¤[Github issue](https://github.com/cypress-io/cypress-documentation/issues/new/choose)ã€‚ç¥æµ‹è¯•æ„‰å¿«ï¼

## å¦è¯·å‚é˜…

- [è·¨æºæµ‹è¯•æŒ‡å—](/app/guides/cross-origin-testing)
- [AWS Cognitoè®¤è¯æŒ‡å—](/app/guides/authentication-testing/amazon-cognito-authentication)
- [Azure Active Directoryè®¤è¯æŒ‡å—](/app/guides/authentication-testing/azure-active-directory-authentication)
- [`cy.origin()`](/api/commands/origin)
- [`cy.session()`](/api/commands/session)