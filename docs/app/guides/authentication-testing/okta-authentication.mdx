---
title: 'Oktaè®¤è¯ï¼šCypressæŒ‡å—'
sidebar_label: 'Oktaè®¤è¯'
description: 'åœ¨Cypressç«¯åˆ°ç«¯æµ‹è¯•ä¸­å®ç°Oktaè®¤è¯ã€‚ç¡®ä¿Cypressæµ‹è¯•åœºæ™¯çš„å®‰å…¨å¯é è®¤è¯æµç¨‹'
---

<ProductHeading product="app" />

# Oktaè®¤è¯

:::info

##### <Icon name="question-circle" color="#4BBFD2" /> æ‚¨å°†å­¦ä¹ åˆ°

- å¦‚ä½•åœ¨Cypressä¸­æµ‹è¯•Oktaè®¤è¯
- å¦‚ä½•åœ¨Cypressä¸­è®¾ç½®Oktaå‡­è¯
- å¦‚ä½•ä¸ºæµ‹è¯•é€‚é…Oktaåº”ç”¨

:::

æœ¬æŒ‡å—çš„èŒƒå›´ä»…æ¼”ç¤ºé’ˆå¯¹[Oktaé€šç”¨ç›®å½•](https://www.okta.com/products/universal-directory/)çš„è®¤è¯ã€‚

## Oktaå¼€å‘è€…æ§åˆ¶å°è®¾ç½®

å¦‚æœå°šæœªè®¾ç½®ï¼Œæ‚¨éœ€è¦åœ¨Oktaå¼€å‘è€…æ§åˆ¶å°ä¸­[åˆ›å»ºä¸€ä¸ªOktaåº”ç”¨](https://okta.com)ã€‚åˆ›å»ºOktaåº”ç”¨åï¼ŒOktaå¼€å‘è€…æ§åˆ¶å°å°†æä¾›ä¸€ä¸ª**å®¢æˆ·ç«¯ID**ï¼Œè¯¥IDå°†ä¸æ‚¨çš„**OktaåŸŸå**ä¸€èµ·ç”¨äº[é…ç½®Okta SDK](https://developer.okta.com/docs/app/sign-into-spa/react/configure-the-sdk/)ï¼Œå¦‚æœ¬æŒ‡å—åç»­éƒ¨åˆ†æ‰€ç¤ºã€‚

## åœ¨Cypressä¸­è®¾ç½®Oktaåº”ç”¨å‡­è¯

ä¸ºäº†åœ¨æµ‹è¯•ä¸­è®¿é—®æµ‹è¯•ç”¨æˆ·å‡­è¯ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®Cypressä½¿ç”¨`.env`æ–‡ä»¶ä¸­è®¾ç½®çš„Oktaç¯å¢ƒå˜é‡ã€‚

:::cypress-config-example

```js
// ä».envæ–‡ä»¶å¡«å……process.env
require('dotenv').config()
```

```js
{
  env: {
    auth_username: process.env.AUTH_USERNAME,
    auth_password: process.env.AUTH_PASSWORD,
    okta_domain: process.env.REACT_APP_OKTA_DOMAIN,
    okta_client_id: process.env.REACT_APP_OKTA_CLIENTID,
  },
}
```

:::

## Oktaè®¤è¯çš„è‡ªå®šä¹‰å‘½ä»¤

æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è¿›è¡ŒOktaè®¤è¯ï¼š

- [ä½¿ç”¨`cy.origin()`ç™»å½•](#ä½¿ç”¨cyoriginç™»å½•)
- [ç¼–ç¨‹å¼è®¿é—®](#ç¼–ç¨‹å¼ç™»å½•)

### ä½¿ç”¨`cy.origin()`ç™»å½•

æˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªåä¸º`loginByOkta`çš„è‡ªå®šä¹‰å‘½ä»¤æ¥æ‰§è¡ŒOktaç™»å½•ã€‚è¯¥å‘½ä»¤å°†ä½¿ç”¨[`cy.origin()`](/api/commands/origin)æ¥ï¼š

1. å¯¼èˆªåˆ°Oktaæº
2. è¾“å…¥ç”¨æˆ·å‡­è¯
3. ç™»å½•å¹¶é‡å®šå‘å›[Cypress Real World App](https://github.com/cypress-io/cypress-realworld-app)
4. ä½¿ç”¨[`cy.session()`](/api/commands/session)ç¼“å­˜ç»“æœ

```jsx title="cypress/support/auth-provider-commands/okta.ts"
// Okta
const loginToOkta = (username: string, password: string) => {
  Cypress.log({
    displayName: 'OKTA LOGIN',
    message: [`ğŸ” Authenticating | ${username}`],
    autoEnd: false,
  })

  cy.visit('/')
  cy.origin(
    Cypress.env('okta_domain'),
    { args: { username, password } },
    ({ username, password }) => {
      cy.get('input[name="identifier"]').type(username)
      cy.get('input[name="credentials.passcode"]').type(password, {
        log: false,
      })
      cy.get('[type="submit"]').click()
    }
  )

  cy.get('[data-test="sidenav-username"]').should('contain', username)
}
// ç›®å‰æˆ‘ä»¬çš„è‡ªå®šä¹‰å‘½ä»¤å¾ˆç®€å•ã€‚ç¨åä¼šæ›´å¤šï¼
Cypress.Commands.add('loginByOkta', (username: string, password: string) => {
  return loginToOkta(username, password)
})
```

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æµ‹è¯•ä¸­ä½¿ç”¨`loginByOkta`å‘½ä»¤ã€‚ä»¥ä¸‹æ˜¯é€šè¿‡Oktaä»¥ç”¨æˆ·èº«ä»½ç™»å½•å¹¶è¿è¡Œä¸€äº›åŸºæœ¬æ£€æŸ¥çš„æµ‹è¯•ã€‚

:::info

è¯¥æµ‹è¯•çš„[å¯è¿è¡Œç‰ˆæœ¬](https://github.com/cypress-io/cypress-realworld-app/blob/develop/cypress/tests/ui-auth-providers/okta.spec.ts)åœ¨<Icon name="github" inline="true" contentType="rwa" />ä¸­ã€‚

:::

```jsx title="auth.cy.js"
describe('Okta', function () {
  beforeEach(function () {
    cy.task('db:seed')
    cy.loginByOkta(Cypress.env('okta_username'), Cypress.env('okta_password'))
  })

  it('éªŒè¯ç™»å½•ç”¨æˆ·æ²¡æœ‰é“¶è¡Œè´¦æˆ·', function () {
    cy.get('[data-test="sidenav-bankaccounts"]').click()
    cy.get('[data-test="empty-list-header"]').should('be.visible')
  })
})
```

<DocsVideo
  src="https://vimeo.com/789093739"
  title="ä½¿ç”¨cy.origin()è¿›è¡ŒOktaè®¤è¯"
/>

æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é‡æ„æˆ‘ä»¬çš„ç™»å½•å‘½ä»¤ï¼Œåˆ©ç”¨[`cy.session()`](/api/commands/session)æ¥å­˜å‚¨æˆ‘ä»¬çš„ç™»å½•ç”¨æˆ·ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦åœ¨æ¯ä¸ªæµ‹è¯•ä¸­é‡æ–°è®¤è¯ã€‚

```jsx title="cypress/support/commands.js"
Cypress.Commands.add('loginByOkta', (username: string, password: string) => {
  cy.session(
    `okta-${username}`,
    () => {
      return loginToOkta(username, password)
    },
    {
      validate() {
        cy.visit('/')
        cy.get('[data-test="sidenav-username"]').should('contain', username)
      },
    }
  )
})
```

<DocsVideo
  src="https://vimeo.com/789093688"
  title="ä½¿ç”¨cy.session()è¿›è¡ŒOktaè®¤è¯"
/>

### ç¼–ç¨‹å¼ç™»å½•

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªåä¸º`loginByOktaApi`çš„å‘½ä»¤ï¼Œä»¥ç¼–ç¨‹æ–¹å¼ç™»å½•Oktaå¹¶åœ¨`localStorage`ä¸­è®¾ç½®ä¸€ä¸ªåŒ…å«è®¤è¯ç”¨æˆ·è¯¦ç»†ä¿¡æ¯çš„é¡¹ï¼Œæˆ‘ä»¬å°†åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­ä½¿ç”¨å®ƒæ¥éªŒè¯æˆ‘ä»¬åœ¨æµ‹è¯•ä¸­æ˜¯å¦å·²è®¤è¯ã€‚

ä¸ºäº†ç¡®ä¿è¿™åœ¨<Icon name="github" inline="true" contentType="rwa" />ä¸­å¯ç”¨ï¼Œå°†`REACT_APP_OKTA_PROGRAMMATIC`ç¯å¢ƒå˜é‡è®¾ç½®ä¸º`true`ã€‚

`loginByOktaApi`å‘½ä»¤å°†æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

1. ä½¿ç”¨[Oktaè®¤è¯API](https://developer.okta.com/docs/reference/api/authn/)æ‰§è¡Œç¼–ç¨‹å¼ç™»å½•ã€‚
2. ä½¿ç”¨[Okta Auth SDK](https://github.com/okta/okta-auth-js)ä¸­çš„`OktaAuth`å®¢æˆ·ç«¯å®ä¾‹åœ¨è·å–ä¼šè¯ä»¤ç‰Œåè·å–`id_token`ã€‚
3. æœ€åï¼Œ`oktaCypress` localStorageé¡¹è¢«è®¾ç½®ä¸ºåŒ…å«`access token`å’Œç”¨æˆ·é…ç½®æ–‡ä»¶ã€‚

```jsx title="cypress/support/commands.js"
import { OktaAuth } from '@okta/okta-auth-js'

// Okta
Cypress.Commands.add('loginByOktaApi', (username, password) => {
  cy.request({
    method: 'POST',
    url: `https://${Cypress.env('okta_domain')}/api/v1/authn`,
    body: {
      username,
      password,
    },
  }).then(({ body }) => {
    const user = body._embedded.user
    const config = {
      issuer: `https://${Cypress.env('okta_domain')}/oauth2/default`,
      clientId: Cypress.env('okta_client_id'),
      redirectUri: 'http://localhost:3000/implicit/callback',
      scopes: ['openid', 'email', 'profile'],
    }

    const authClient = new OktaAuth(config)

    return authClient.token
      .getWithoutPrompt({ sessionToken: body.sessionToken })
      .then(({ tokens }) => {
        const userItem = {
          token: tokens.accessToken.value,
          user: {
            sub: user.id,
            email: user.profile.login,
            given_name: user.profile.firstName,
            family_name: user.profile.lastName,
            preferred_username: user.profile.login,
          },
        }

        window.localStorage.setItem('oktaCypress', JSON.stringify(userItem))

        log.snapshot('after')
        log.end()
      })
  })
})
```

åœ¨Oktaå¼€å‘è€…æ§åˆ¶å°ä¸­æ­£ç¡®è®¾ç½®Oktaåº”ç”¨ï¼Œæ”¾ç½®å¿…è¦çš„ç¯å¢ƒå˜é‡ï¼Œå¹¶å®ç°`loginByOktaApi`å‘½ä»¤åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æµ‹è¯•åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨Oktaè¿›è¡Œè®¤è¯ã€‚ä»¥ä¸‹æ˜¯é€šè¿‡Oktaä»¥ç”¨æˆ·èº«ä»½ç™»å½•ã€å®Œæˆå¼•å¯¼æµç¨‹å¹¶æ³¨é”€çš„æµ‹è¯•ã€‚

```jsx title="auth.cy.js"
describe('Okta', function () {
  beforeEach(function () {
    cy.task('db:seed')
    cy.loginByOktaApi(
      Cypress.env('auth_username'),
      Cypress.env('auth_password')
    )
  })

  it('æ˜¾ç¤ºå¼•å¯¼', function () {
    cy.contains('Get Started').should('be.visible')
  })
})
```

:::info

è¯¥æµ‹è¯•çš„[å¯è¿è¡Œç‰ˆæœ¬](https://github.com/cypress-io/cypress-realworld-app/blob/develop/cypress/tests/ui-auth-providers/okta.spec.ts)åœ¨<Icon name="github" inline="true" contentType="rwa" />ä¸­ã€‚

:::

### ä¸ºæµ‹è¯•é€‚é…Oktaåº”ç”¨

:::info

<strong>æ³¨æ„</strong>

ä¸Šä¸€èŠ‚é‡ç‚¹ä»‹ç»äº†åœ¨Cypressæµ‹è¯•ä¸­ä½¿ç”¨ç¼–ç¨‹å¼Oktaè®¤è¯çš„å®è·µã€‚è¦ä½¿ç”¨æ­¤å®è·µï¼Œå‡è®¾æ‚¨æ­£åœ¨æµ‹è¯•ä¸€ä¸ªé€‚å½“æ„å»ºæˆ–é€‚é…ä»¥ä½¿ç”¨Oktaçš„åº”ç”¨ç¨‹åºã€‚

ä¸ç¼–ç¨‹å¼ç™»å½•ä¸åŒï¼Œä½¿ç”¨[`cy.origin()`](/api/commands/origin)è¿›è¡Œè®¤è¯ä¸éœ€è¦é€‚é…åº”ç”¨ç¨‹åºå³å¯å·¥ä½œã€‚æ­¤æ­¥éª¤ä»…åœ¨å®ç°ç¼–ç¨‹å¼ç™»å½•æ—¶éœ€è¦ã€‚

ä»¥ä¸‹éƒ¨åˆ†æä¾›äº†æ„å»ºæˆ–é€‚é…åº”ç”¨ç¨‹åºä»¥ä½¿ç”¨Oktaè®¤è¯çš„æŒ‡å¯¼ã€‚

:::

<Icon name="github" inline="true" contentType="rwa" />è¢«ä½¿ç”¨ï¼Œå¹¶ä¸ºReact SPAå’ŒExpressåç«¯æä¾›äº†é…ç½®å’Œå¯è¿è¡Œä»£ç ã€‚

å‰ç«¯ä½¿ç”¨[Okta React SDK](https://github.com/okta/okta-react)ç”¨äºReactå•é¡µåº”ç”¨ç¨‹åº(SPA)ï¼Œå…¶åº•å±‚ä½¿ç”¨[Okta Auth SDK](https://github.com/okta/okta-auth-js)ã€‚åç«¯ä½¿ç”¨[Okta JWT Verifier for Node.js](https://github.com/okta/okta-oidc-js/tree/master/packages/jwt-verifier)æ¥éªŒè¯æ¥è‡ª[Okta](https://okta.com)çš„JWTã€‚

:::info

å¯åŠ¨[Cypress Real World App](https://github.com/cypress-io/cypress-realworld-app)æ—¶ä½¿ç”¨`yarn dev:okta`å‘½ä»¤ã€‚

:::

#### é€‚é…åç«¯

ä¸ºäº†éªŒè¯æ¥è‡ªå‰ç«¯çš„APIè¯·æ±‚ï¼Œæˆ‘ä»¬å®‰è£…[Okta JWT Verifier for Node.js](https://github.com/okta/okta-oidc-js/tree/master/packages/jwt-verifier)å¹¶ä½¿ç”¨[åˆ›å»ºOktaåº”ç”¨](https://developer.okta.com/docs/app/sign-into-spa/react/create-okta-application/)åæä¾›çš„OktaåŸŸåå’Œå®¢æˆ·ç«¯IDè¿›è¡Œé…ç½®ã€‚

```jsx title="backend/helpers.ts"
import OktaJwtVerifier from '@okta/jwt-verifier'

dotenv.config()

// OktaéªŒè¯JWTç­¾å
const oktaJwtVerifier = new OktaJwtVerifier({
  issuer: `https://${process.env.REACT_APP_OKTA_DOMAIN}/oauth2/default`,
  clientId: process.env.REACT_APP_OKTA_CLIENTID,
  assertClaims: {
    aud: 'api://default',
    cid: process.env.REACT_APP_OKTA_CLIENTID,
  },
})
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªExpressä¸­é—´ä»¶å‡½æ•°ï¼Œç”¨äºåœ¨æˆ‘ä»¬çš„è·¯ç”±ä¸­éªŒè¯å‰ç«¯APIè¯·æ±‚å‘é€çš„[Okta](https://okta.com) JWTä½œä¸º`Bearer`ä»¤ç‰Œã€‚

```jsx title="backend/helpers.ts"
// ...

export const verifyOktaToken = (req, res, next) => {
  const bearerHeader = req.headers['authorization']

  if (bearerHeader) {
    const bearer = bearerHeader.split(' ')
    const bearerToken = bearer[1]

    oktaJwtVerifier
      .verifyAccessToken(bearerToken, 'api://default')
      .then((jwt) => {
        // ä»¤ç‰Œæœ‰æ•ˆ
        req.user = {
          // @ts-ignore
          sub: jwt.sub,
        }

        return next()
      })
      .catch((err) => {
        // éªŒè¯å¤±è´¥ï¼Œæ£€æŸ¥é”™è¯¯
        console.log('error', err)
      })
  } else {
    res.status(401).send({
      error: 'Unauthorized',
    })
  }
}
```

å®šä¹‰æ­¤è¾…åŠ©å‡½æ•°åï¼Œæˆ‘ä»¬å¯ä»¥å…¨å±€åº”ç”¨å®ƒåˆ°æ‰€æœ‰è·¯ç”±ï¼š

```jsx title="backend/app.ts"
// åˆå§‹å¯¼å…¥ ...
import { verifyOktaToken } from './helpers'

// ...

if (process.env.REACT_APP_OKTA) {
  app.use(verifyOktaToken)
}

// è·¯ç”± ...
```

#### é€‚é…å‰ç«¯

æˆ‘ä»¬éœ€è¦æ›´æ–°æˆ‘ä»¬çš„å‰ç«¯Reactåº”ç”¨ç¨‹åºï¼Œä»¥å…è®¸ä½¿ç”¨[Okta React SDK](https://github.com/okta/okta-react)è¿›è¡ŒOktaè®¤è¯ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬åŸºäº`App.tsx`ç»„ä»¶åˆ›å»ºä¸€ä¸ª`AppOkta.tsx`å®¹å™¨ã€‚

`AppOkta.tsx`ä½¿ç”¨`useOktaAuth` React Hookï¼Œç”¨`SecureRoute`å’Œ`LoginCallback`æ›¿æ¢Sign Upå’ŒSign Inè·¯ç”±ï¼Œå¹¶ç”¨`withOktaAuth`é«˜é˜¶ç»„ä»¶(HOC)åŒ…è£…ç»„ä»¶ã€‚

æ·»åŠ ä¸€ä¸ª`useEffect`é’©å­ä»¥è·å–è®¤è¯ç”¨æˆ·çš„è®¿é—®ä»¤ç‰Œï¼Œå¹¶å‘ç°æœ‰çš„è®¤è¯å±‚(`authMachine.ts`)å‘é€å¸¦æœ‰`user`å’Œ`token`å¯¹è±¡çš„`OKTA`äº‹ä»¶ã€‚æˆ‘ä»¬ä¸º`implicit/callback`å®šä¹‰ä¸€ä¸ªè·¯ç”±ä»¥æ¸²æŸ“`LoginCallback`ç»„ä»¶ï¼Œå¹¶ä¸ºæ ¹è·¯å¾„å®šä¹‰ä¸€ä¸ª`SecureRoute`ã€‚

```jsx title="src/containers/AppOkta.tsx"
// åˆå§‹å¯¼å…¥ ...
import {
  LoginCallback,
  SecureRoute,
  useOktaAuth,
  withOktaAuth,
} from '@okta/okta-react'

// ...

const AppOkta: React.FC = () => {
  const { authState, oktaAuth } = useOktaAuth()

  // ...

  useEffect(() => {
    if (authState.isAuthenticated) {
      oktaAuth.getUser().then((user) => {
        authService.send('OKTA', { user, token: oktaAuthState.accessToken })
      })
    }
  }, [authState, oktaAuth])

  // ...

  return (
    <div className={classes.root}>
      // ...
      {authState.matches('unauthorized') && (
        <>
          <Route path="/implicit/callback" component={LoginCallback} />
          <SecureRoute exact path="/" />
        </>
      )}
      // ...
    </div>
  )
}

export default withOktaAuth(AppOkta)
```

:::info

å®Œæ•´çš„[AppOkta.tsxç»„ä»¶](https://github.com/cypress-io/cypress-realworld-app/blob/develop/src/containers/AppOkta.tsx)åœ¨<Icon name="github" inline="true" contentType="rwa" />ä¸­ã€‚

:::

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ›´æ–°å…¥å£ç‚¹(`index.tsx`)ï¼Œç”¨[Okta React SDK](https://github.com/okta/okta-react)çš„`<Security>`ç»„ä»¶åŒ…è£…æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œæä¾›`issuer`ã€`clientId`ï¼ˆæ¥è‡ªæˆ‘ä»¬çš„Oktaåº”ç”¨ï¼‰ä»¥åŠ`redirectUri`ä½œä¸ºpropsï¼Œä½¿ç”¨`.env`ä¸­å®šä¹‰çš„`REACT_APP_OKTA`å˜é‡ã€‚

```jsx title="src/index.tsx"
// åˆå§‹å¯¼å…¥ ...
import { OktaAuth } from '@okta/okta-auth-js'
import { Security } from '@okta/okta-react'
import AppOkta from './containers/AppOkta'

// ...

const oktaAuth = new OktaAuth({
  issuer: `https://${process.env.REACT_APP_OKTA_DOMAIN}/oauth2/default`,
  clientId: process.env.REACT_APP_OKTA_CLIENTID,
  redirectUri: window.location.origin + '/implicit/callback',
})

ReactDOM.render(
  <Router history={history}>
    <ThemeProvider theme={theme}>
      {process.env.REACT_APP_OKTA ? (
        <Security oktaAuth={oktaAuth}>
          <AppOkta />
        </Security>
      ) : (
        <App />
      )}
    </ThemeProvider>
  </Router>,
  document.getElementById('root')
)
```

éœ€è¦å¯¹æˆ‘ä»¬çš„[AppOkta.tsxç»„ä»¶](https://github.com/cypress-io/cypress-realworld-app/blob/develop/src/containers/AppOkta.tsx)è¿›è¡Œæ›´æ–°ï¼Œä»¥æœ‰æ¡ä»¶åœ°ä½¿ç”¨`oktaCypress` localStorageé¡¹ã€‚

åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åŸºäºåœ¨Cypressä¸‹æµ‹è¯•ï¼ˆä½¿ç”¨`window.Cypress`ï¼‰æœ‰æ¡ä»¶åœ°åº”ç”¨ä¸€ä¸ª`useEffect`å—ã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬å°†æ›´æ–°å¯¼å‡ºï¼Œä»…åœ¨ä¸åœ¨Cypressæµ‹è¯•ä¸­æ—¶ç”¨`withOktaAuth`é«˜é˜¶ç»„ä»¶åŒ…è£…ã€‚è¿™å…è®¸æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåœ¨å¼€å‘/ç”Ÿäº§ä¸­ä½¿ç”¨[Okta](https://okta.com)é‡å®šå‘ç™»å½•æµç¨‹ï¼Œä½†åœ¨Cypressæµ‹è¯•ä¸­ä¸ä½¿ç”¨ã€‚

```jsx title="src/containers/AppOkta.tsx"
// åˆå§‹å¯¼å…¥ ...
import { LoginCallback, SecureRoute, useOktaAuth, withOktaAuth } from "@okta/okta-react";

// ...

const AppOkta: React.FC = () => {
  const { authState, oktaAuth } = useOktaAuth();

  // ...

  // å¦‚æœåœ¨Cypressä¸‹æµ‹è¯•ï¼Œä»"oktaCypress" localStorageé¡¹è·å–å‡­è¯å¹¶å‘é€äº‹ä»¶åˆ°æˆ‘ä»¬çš„çŠ¶æ€ç®¡ç†ä»¥ç™»å½•SPA
  if (window.Cypress) {
    useEffect(() => {
      const okta = JSON.parse(localStorage.getItem("oktaCypress")!);
      authService.send("OKTA", {
        user: okta.user,
        token: okta.token,
      });
    }, []);
  } else {
    useEffect(() => {
      if (authState.isAuthenticated) {
        oktaAuth.getUser().then((user) => {
          authService.send("OKTA", { user, token: oktaAuthState.accessToken });
        });
      }
    }, [authState, oktaAuth]);
  }

  // ...

  return (
    <div className={classes.root}>

      // ...

      {authState.matches("unauthorized") && (
        <>
          <Route path="/implicit/callback" component={LoginCallback} />
          <SecureRoute exact path="/" />
        </>
      )}

      // ...
    </div>
  );
};

// å¦‚æœä¸åœ¨Cypressä¸‹æµ‹è¯•ï¼Œæœ‰æ¡ä»¶åœ°ç”¨`withOktaAuth`åŒ…è£…å¯¼å‡º
let appOkta = window.Cypress ? AppOkta : withOktaAuth(AppOkta);
export default appOkta;
```